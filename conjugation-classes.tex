\section{Conjugacy classes of the symmetric group}

In this section, we further the computation of $\widehat{N}_{g,d}$ by using techniques inspired by graph theory. The rough picture is one of a graph with vertices the conjugacy classes of $\Sym_d$ and edges representing the passage from one class to another by multiplication with a simple transposition. We seek to count not cycles, but cycles starting and ending with the same representative, in the sense specified below. To do this, we make use of an analogue of the adjacency matrix for a graph.

To abbreviate, we use the term ``transposition'' for simple transpositions. Again, we denote by $t$ the set of simple transpositions in $\Sym_d$.

\subsection{Conjugacy cycles}

Recall the definition
\begin{align*}
  \widehat{T}_{g,d} = \{(\tau_1,\dotsc,\tau_{2g-2},\sigma_1,\sigma_2)\in \Sym_d^{2g} \scl \tau_i\in t \text{ for all $i$, } &\tau_1\dotsm\tau_{2g-2}=\sigma_1\sigma_2\sigma_1^{-1}\sigma_2^{-1}\}.
 \end{align*}
Our aim is now to rewrite this definition using conjugacy classes. Note that the condition in the definition is equivalent to
\begin{align*} \label{eq:conj-cond}
 (\tau_1 \dotsm \tau_{2g-2})\sigma_2=\sigma_1\sigma_2\sigma_1^{-1}.
\end{align*}
In particular, it is necessary for the product $(\tau_1 \dotsm \tau_{2g-2})\sigma_2$ to be conjugated to $\sigma_2$.

For $\sigma\in\Sym_d$, denote the conjugacy class of $\sigma$ in $\Sym_d$ by $c(\sigma)$.
\begin{defi}
 For $\sigma \in \Sym_d$, define
 \begin{align*}
  P_{g,d}(\sigma) = \{(\tau_1,\dotsc,\tau_{2g-2})\in \Sym_d^{2g-2} \scl \tau_i\in t \text{ for all $i$, } &c(\tau_1\dotsm\tau_{2g-2}\sigma)=c(\sigma)\}.
 \end{align*}
 If $g=1$, define $P_{g,d}(\sigma)$ to be the singleton set $\{\bullet\}$.
\end{defi}

\begin{prop}
 Let $\mc{R}=\{\sigma^{(1)},\dotsc,\sigma^{(r)}\}$ be a system of (distinct) representatives of the conjugacy classes of $\Sym_d$. Then \[\abs{\widehat{T}_{g,d}}=\sum_{\sigma\in\mc{R}}d!\abs{P_{g,d}(\sigma)}.\]
\end{prop}
\begin{proof}
 We begin by noting that if $(\tau_1,\dotsc,\tau_{2g-2})\in P_{g,d}$ and $\sigma\in\Sym_d$, then there is a bijection
 \[
  \{\sigma'\in\Sym_d\scl (\tau_1 \dotsm \tau_{2g-2})\sigma=\sigma'\sigma(\sigma')^{-1}\} \to
  \Stab_{\Sym_d}(\sigma).
 \]
 Indeed, choose an arbitrary element $\sigma'_0$ of the first set and define the bijection by sending $\sigma'$ to $(\sigma'_0)^{-1}\sigma'$.
 
 To count the elements in $\what{T}_{g,d}$, we fix $\sigma$ and we ask first first how many tuples $(\tau_1,\dotsc,\tau_{2g-2})$ satisfy the necessary condition of $(\tau_1,\dotsc,\tau_{2g-2})\sigma$ being conjugate to $\sigma$, next we count the number of ways to realize such a conjugacy relation, which is exactly $\abs{\Stab_{\Sym_d}(\sigma)}$. We obtain
 
 \[
  \abs{\widehat{T}_{g,d}}=\sum_{\sigma\in\Sym_d}\abs{\Stab_{\Sym_d}}\abs{P_{g,d}(\sigma)}=\sum_{\sigma\in\Sym_d}\frac{d!}{\abs{c(\sigma)}}\abs{P_{g,d}(\sigma)}.
 \]
The function $\abs{P_{g,d}}\cl\Sym_d\to\Zbb$ is constant on conjugacy classes. Indeed, for $\sigma'\in\Sym_d$ there is a bijection of $P_{g,d}(\sigma)$ onto $P_{g,d}(\sigma'\sigma(\sigma')^{-1})$ given by conjugation with $\sigma'$ in each component. From this follows the required equality.
\end{proof}
The above proposition, together with Lemma \ref{prop:first-reduction-step}, give the following reduction step:
\begin{cor} \label{prop:first-second-reduction-step}
  We have the equality
 \[
  \widehat{N}_{g,d}=\sum_{\sigma\in\mathcal{R}}\abs{P_{g,c}(\sigma)}.
 \]
\end{cor}

From now on, let $\mc{R}=\{\sigma^{(1)},\dotsc,\sigma^{(r)}\}$ be a fixed system of representatives of the conjugacy classes of $\Sym_d$. Then the cardinality $r=\partit(d)$ of $\mc{R}$ is the number of (unordered) partitions of $\{1,\dotsc,d\}$. This follows essentially from the fact that the conjugacy class of a permutation is uniquely determined by its \emph{cycle shape}, that is the multiset $\{a_{1},\dotsc,a_{s}\}$ whose elements are the respective sizes of the $s$ cycles making up the (reduced) cycle decomposition of the permutation. Such sets are in a one-to-one correspondence with the partitions of $d$, since each cycle entry $1,\dotsc,d$ must appear exactly once in the cycle decomposition.

\subsection{Adjacency matrices}

\begin{defi}
 Let $d\geq 1$ and $k\geq 0$.
 
  1. For $1\leq i,j\leq r$, define the sets $E_{d,i,j}^k$ by
  \begin{align*}
   E_{d,i,j}^k = \{(\tau_1,\dotsc,\tau_k)\in \Sym_d^{k} \scl \tau_i\in t \text{ for all $i$, } &c(\tau_1\dotsm\tau_k\sigma^{(i)})= c(\sigma^{(j)})\}.
  \end{align*}
  For $k=0$, define $E_{d,i,j}^0$ to be the empty set if $i\neq j$ and the singleton set if $i=j$.
  
  2. Define the square matrix $M_d$ by
  \[
   (M_d)_{i,j}=\abs{E_{d,i,j}^1}.
  \]
  The matrix $M_d$ is a square matrix of size $r$, its definition does not depend on the choice of system of representatives $\mc{R}$.
\end{defi}

\begin{rmk}
 If $k$ is odd, applying the signum to the defining condition shows that $E_{d,i,i}^k$ is empty. If $k=2g-2$ is even, then $E_{d,i,i}^{2g-2}=P_{g,d}(\sigma^{(i)})$.
\end{rmk}

\begin{prop}
 The entries of $M_d^k$ are given by $(M_d^k)_{i,j}=\abs{E_{d,i,j}^k}$.
\end{prop}
\begin{proof}
 The proof is by induction on $k$. For $k=0,1$, there is nothing to show. For the induction step, note that if $i$ (resp. $j$) are fixed, the sets $E_{d,i,j}^k$ are pairwise disjoint for varying $j$ (reps. $i$). We seek to define a bijection
 \[
  \phi\cl\coprod_{l=1}^r E_{d,i,l}^k \times E_{d,l,j}^1 \to E_{d,i,j}^{k+1}.
 \]
 First, for each element $(\tau_1,\dotsc,\tau_k)$ of $E_{d,i,l}^k$, choose an element $\sigma\in\Sym_d$ such that $\tau_1\dotsm\tau_k\sigma^{(i)}=\sigma\sigma^{(l)}\sigma^{-1}$. Second, define the image of $((\tau_1,\dotsc,\tau_k),\tau_0)$ under $\phi$ to be $(\sigma\tau_0\sigma^{-1},\tau_1,\dotsc,\tau_k)$. By the definition of matrix multiplication, it suffices to prove that $\phi$ is a bijection.
 
 Injectivity is clear. For surjectivity, given an element $(\tau'_0,\tau_1,\dotsc,\tau_k)$ in the target, choose an $l$ such that $\tau_1\dotsm\tau_k\sigma^{(i)}$ is conjugate to $\sigma^{(l)}$, say $\tau_1\dotsm\tau_k\sigma^{(i)}=\sigma\sigma^{(l)}\sigma^{-1}$. Then $(\sigma^{-1}\tau_0\sigma)\sigma^{(l)}$ is conjugate to $\sigma^{(j)}$.
\end{proof}

\begin{lemma} \label{prop:counting-fct}
 Let $d\geq 1$ and $r=\partit(d)$. Let $\mu_{1,d},\dotsc,\mu_{r,d}$ be the eigenvalues of $M_d$, listed according to their algebraic multiciplicities. Then
 \[
  \widehat{Z}(q,\lambda)=\sum_{d\geq1}\sum_{i=1}^r \exp(\mu_{i,d}\lambda)q^d.
 \]
\end{lemma}
\begin{proof}
 Recall the definition of $\widehat{Z}$:
 \[\widehat{Z}(q,\lam) = \sum_{g\geq 1}\sum_{d\geq 1} \frac{\widehat{N}_{g,d}}{(2g-2)!}q^d\lam^{2g-2}.\]
 The above proposition and remark give $(M_d^{2g-2})_{i,i}=\abs{P_{g,d}(\sigma^{(i)})}$ and $(M_d^k)_{i,i}=0$ if $k$ is odd, for all $i$. Hence, by \ref{prop:first-second-reduction-step} one has $\widehat{N}_{g,d}=\Tr(M_d^{2g-2})=\sum_{i=1}^r \mu_{i,d}^{2g-2}$, and since the terms for $k$ odd vanish,
 \begin{align*}
  \widehat{Z}(q,\lam)&=\sum_{g\geq1}\sum_{d\geq1}\frac{\Tr(M^{2g-2}_d)}{(2g-2)!)}q^d\lam^{2g-2}\\
  &=\sum_{d\geq1}\sum_{i=1}^r\sum_{g\geq1}\frac{\mu_{i,d}^{2g-2}}{(2g-2)!}\lam^{2g-2}q^d\\
  &=\sum_{d\geq1}\sum_{i=1}^r \exp(\mu_{i,d}\lambda)q^d.
 \end{align*}
\end{proof}