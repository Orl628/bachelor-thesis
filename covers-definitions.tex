\section{Covers of an elliptic curve} \label{sec:covers-definitions}

In this section we define the central notions and objects of interest, \ie finite covers of an elliptic curve with simple ramification type, the weighted counts of isomorphism classes thereof, and the generating functions associated to such weighted counts.

In the following, let $\Cbb$ be the ground field for all varieties considered.

\if 0
\begin{defi} Let $E$ be an elliptic curve. 
 \begin{enumerate}
  \item A \emph{(degree d, genus g, connected) cover of $E$} is a finite, degree $d$ morphism $p\cl C\to E$ of an irreducible smooth curve $C$ of genus $g$ onto $E$. Denote such a cover by $(C,p)$, possibly omitting the structure map $p$.

  \item If $S={b_1,\dotsc,b_{2g-2}}$ is a set of $2g-2$ distinct points of $E$, call a cover $C$ \emph{simply branched over $S$}, if it is simply branched over each point of $S$. This means that for all points $b$ of $S$ there is exacly one point $x$ in $p^{-1}(b)$ with ramification index $\e_p(x)=2$, the others having a ramification index one.
  
  It follows from the Riemann-Hurwitz formula of Proposition \ref{prop:hurwitz} that every point not in the pre-image of $S$ has a ramification index of one. This justifies the choice of the number of points in $S$.

  \item Two covers $C_1, C_2$ are to be considered isomorphic, if there is an isomorphism $C_1\to C_2$ commuting with the respective structure maps into $E$. Accordingly, define the automorphism group $\Aut_p(C)=\Aut(C)$ of the cover $(C,p)$ to be the group of cover isomorphisms $C\to C$. 
 \end{enumerate}
\end{defi}
\fi

\begin{defi} Let $E$ be an elliptic curve.
 \begin{enumerate}
  \item A \emph{cover} of $E$ is a finite morphism $p\cl C\to E$ of a disjoint union $C=\cup_{i=1}^k C_i$ of $k$ irreducible smooth curves $C_i$. We shall denote the genus of $C$ by $g$ and the degree of $p$ by $d$. Often a cover will be referred to by its source $C$.
  
  \item Let $S=\{b_1,\dotsc,b_{2g-2}\}$ be a set of $2g-2$ distinct points of $E$. A cover $C$ of genus $g$ is \emph{simply branched over $S$}, if it is simply branched over each point of $S$. This means that for all points $b$ of $S$ there is exacly one point $x$ in $p^{-1}(b)$ with ramification index $\e_p(x)=2$, the others having a ramification index one.
  
  It follows from the Riemann-Hurwitz formula of Proposition \ref{prop:hurwitz} that for a simply branched cover $C\to E$, every point not in the pre-image of $S$ has a ramification index one. This justifies the choice of the number of points in $S$.
  
  \item Two covers $C_1, C_2$ are to be considered isomorphic, if there is an isomorphism $C_1\to C_2$ commuting with the respective structure maps into $E$. Accordingly, define the automorphism group $\Aut(C)$ of the cover $C$ to be the group of cover isomorphisms $C\to C$.
  
  \item A \emph{connected cover} is a cover with connected source $C$, \ie with only one irreducible component.
 \end{enumerate}
\end{defi}

\begin{rmk}
 Let $C=C_1 \cup \dotsb \cup C_k$ be a cover of genus $g$ with structure map $p$ of degree $d$. For all $i$, let $p_i$ be the connected cover defined by the restriction $p|_{C_i}$. Denote the genus of $C_i$ by $g_i$  and the degree of $p_i$ by $d_i$. By the Riemann-Hurwitz formula, the maps $p_i$ have $2g_i-2$ ramification points on $C_i$. Hence, the following relations hold:
 \[\sum_i d_i=d\text{, and }\sum_i (2g_i-2)=2g-2.\]
\end{rmk}

\begin{prop}
 Let $C$ be a connected cover of $E$. Then the automorphism group of $C$ is finite.
\end{prop}

\begin{proof}
 By Proposition \ref{prop:curves-to-fields}, if $C$ is a connected cover of $E$, then the elements of $\Aut(C)$ correspond to the automorphisms of the finite field extension $K(C)/K(E)$, of which only finitely many exist.
\end{proof}

\begin{prop}
 Let $C=C_1 \cup \dotsb \cup C_k$ be a cover, and $p_i\defeq p|_{C_i}$. Then the automorphism group of $C$ is given by the semidirect product \[\Aut(C) = \prod_i \Aut(C_i) \rtimes \Gamma,\] where $\Gamma \subset \Symm\{C_1, \dotsc, C_k\}$ is the subgroup generated by the automorphisms that permute isomorphic components. In particular, $\Aut(C)$ is finite.
\end{prop}
 
\begin{proof}
 The map $\Aut(C) \to \Gamma$ given by looking at the action of an automorphism on the set $\{C_1,\dotsc,C_k\}$ is part of a short exact sequence \[\ses{1}{\prod_i \Aut(C_i)}{\Aut(C)}{\Gamma}{}{}\]
 which admits a splitting $\Gamma \to \Aut(C)$ given by the inclusion.
\end{proof}

\begin{rmk}
 If the cover $C$ is simply branched over $S$, then no two components of genus greater than one are isomorphic as connected covers, since any isomorphism would have to preserve ramification indices (see for example \cite[II, Prop. 2.6]{Silverman2009}), but no two components share a branched point over $E$. In particular, if there are no components of genus one, then $\Gamma=\{1\}$.
 
 On the other hand, each component of genus one is unramified over $E$, and could be isomorphic to other components of genus one, in which case $\Gamma$ is nontrivial.
\end{rmk}
\begin{defi} Let $E$ be an elliptic curve, $S=\{b_1,\dotsc,b_{2g-2}\}$ a set of $2g-2$ distinct points of $E$.
 \begin{enumerate}
  \item Let $\Cov(E,S)_{g,d}$ be the set of isomorphism classes of covers of $E$ of genus $g$ and degree $d$ that are simply branched over $S$.
  
  \item Any isomorphism of two equivalent covers defines a bijection of their automorphism groups. This allows one to define the \emph{weight} of the class $[C]$ to be the number $1/|\Aut(C)|$.
  
  \item Define $\what N_{g,d}$ to be the weighted count \[\what N_{g,d}\defeq\sum_{C\in \Cov(E,S)_{g,d}} \frac{1}{|\Aut(C)|}\] of the (classes of) covers of $E$.
  
  \item Let $\Cov(E,S)^{\circ}_{g,d}\subset\Cov(E,S)_{g,d}$ be the subset of classes $[C]$ such that $C$ is connected.
  
  \item Similarly, define $N_{g,d}$ to be the the weighted count \[N_{g,d}\defeq\sum_{C\in \Cov(E,S)^{\circ}_{g,d}} \frac{1}{|\Aut(C)|}\] of the connected covers of $E$.
 \end{enumerate}
 To shorten the notation, the elliptic curve $E$ and the set of points $S$ are omitted from the notation. It will turn out that $\what N_{g,d}$ and $N_{g,d}$ are finite and do not depend on the choice of $E$ and $S$.
\end{defi}

\begin{defi}
 For any $g\geq 1$, define $F_g$ to be the generating series \[F_g(q)=\sum_{d\geq 1}N_{g,d}q^d\] counting connected covers of genus $g$.
\end{defi}

\begin{expl}
 By the theory of elliptic curves, $N_{1,d}=\sum_{j|d}1/j$. Indeed, Let $E$ be defined by the lattice $\Omega=\gen{1,i}$. The set of divisors of $d$ classify the covers of $E$ by assigning to some $j|d$ the elliptic curve $C_j$ defined by $\Omega_j=\left<1,di/j^2\right>$ and the cover map $C_j\to E\cl z\mapsto jz$. There are $j$ automorphisms $C_j\to C_j$ of this cover, given by $z\mapsto z+k/j, k=0,1,\dotsc,j-1$.
 
 Further, by using the power series expansion for the logarithm \[\log(1+z)=\sum_{n=1}^{\infty}\frac{(-1)^{n-1}}{n}\,z^n\] for $\abs{z}<1$, one finds that $-\sum_{n\geq 1}\log(1-q^n)=\sum_{d\geq 1}\sum_{j|d}\frac{1}{j}q^d.$
 Hence, the first generating function is given by \[F_1(q)=-\sum_{n\geq 1}\log(1-q^n).\]
\end{expl}

This thesis shall prove the following result.

\begin{thm}[\cite{Dijkgraaf}]
 Let $g\geq 2$, and for $\tau\in\Cbb$ let $q(\tau)=\exp(2\pi i\tau)$. Then the function $F_g(q)$ is a quasimodular form of weight $6g-6$.
\end{thm}

The strategy to prove the theorem will involve considering a more general generating function counting all covers of genus $g$ and degree $d$. This generating function will be easier to compute.

\begin{defi}
 The generating functions $Z(q,\lam)$ and $\widehat{Z}(q,\lam)$ for $N_{g,d}$ and $\widehat{N}_{g,d}$ respectively, are defined as follows:
 \[Z(q,\lam) \defeq \sum_{g\geq 1}\sum_{d\geq 1} \frac{N_{g,d}}{(2g-2)!}q^d\lam^{2g-2} 
 = \sum_{g\geq 1}\frac{F_g(q)}{(2g-2)!}\lam^{2g-2},\]
 \[\widehat{Z}(q,\lam) \defeq \sum_{g\geq 1}\sum_{d\geq 1} \frac{\widehat{N}_{g,d}}{(2g-2)!}q^d\lam^{2g-2}.\]
\end{defi}

\begin{lemma} \label{prop:connection-reduction}
 The above generating functions satisfy the relation \[\widehat{Z}(q,\lam) = \exp(Z(q,\lam)) - 1.\]
\end{lemma}
\begin{proof}
The proof is subdivided into three parts. First, some notation and terminology is introduced. Second, the coefficient of $q^{d}\lam^{2g-2}$ in $\exp(Z(q,\lam)) - 1$ is expressed in terms of the new notation. Third, combinatorial arguments are used to prove that this coefficient is equal to $\what{N}_{g,d}/(2g-2)!$.
%1

 Let $C$ be a degree $d$, genus $g$ cover. The \emph{combinatorial type} of $C$ is the tuple $\kappa=(k_j,g_j,d_j)_{j=1}^r$ of natural numbers, such that for each $j$, the space $C$ contains exactly $k_j$ connected components $C_j$ of genus $g_j$ such that the cover map $C_j\to E$ is of degree $d_j$. For simplicity, denote the Euler characteristics $2g-2$ and $2g_j-2$ by $\chi$ and $\chi_j$, respectively. Then
 \[\sum_j d_j=d\text{, and }\sum_j \chi_j=\chi.\]
 Further, define $\what{N}_\kappa$ to be the weighted count of the covers of combinatorial type $\kappa$. Then
 \[
  \what{N}_{g,d}=\sum_{\abs{\kappa}=(\chi,d)}\what{N}_\kappa,
 \]
 where $\abs{\kappa}$ is defined as the tuple $(\sum_j k_j\chi_j,\;\sum_j k_jd_j)$, for $\kappa=(k_j,g_j,d_j)_j$.
 Finally, note that the relation
 \[
  q^d\lam^\chi=\prod_{j=1}^r q^{k_jd_j}\lam^{k_j\chi_j}
 \]
 holds for each $\kappa=(k_j,g_j,d_j)_j$ with $\abs{\kappa}=(\chi,d)$.
%2

 The exponential of $Z(q,\lam)$ is given by 
 \[
  \exp(Z(q,\lam))=\prod_{g\geq 1}\prod_{d\geq 1}\sum_{k\geq 0}\frac{N^k_{g,d}}{k!(\chi!)^k}q^{kd}\lam^{k\chi}.
 \]
 Expanding, one finds that the expression for $\exp(Z(q,\lambda))$ is a sum over terms of the form
 \[
  \prod_{j=1}^{<\infty}\left(\frac{N_{g_j,d_j}}{\chi_j!}\right)^{k_j}\frac{1}{k_j!}q^{k_jd_j}\lam^{k_j\chi_j},
 \]
 for some choices of parameters $g_j, d_j, k_j$. Such choices may be collected to form combinatorial types $\kappa=(g_j,d_j,k_j)_j$. Now, by collecting the summands arising from choices that induce combinatorial types of the same absolute value $\abs\kappa$, one obtains that the coefficient of $q^d\lam^\chi$ in $\exp(Z(q,\lam))$ is equal to the sum $\sum_{\abs\kappa=(\chi,d)}a_\kappa$, where 
 \[
  a_\kappa=\prod_{j=1}^{r}\left(\frac{N_{g_j,d_j}}{\chi_j!}\right)^{k_j}\frac{1}{k_j!}.
 \]
%3

 It remains to prove that $a_\kappa$ = $\what{N}_\kappa$ for each combinatorial type $\kappa$. Sketch:
 \begin{itemize}
  \item The product $N_{g_1,d_1}^{k_1}\dotsm N_{g_r,d_r}^{k_r}$ represents a choice of connected components of a cover. One has to modify this product to account for the automorphisms of the components and the choice of ramification points.
  \item There are $\binom{\chi}{\chi_1,\chi_1\dotsc,\chi_r}=\chi\prod_{j=1}^r 1/(\chi_j!)^{k_j}$ ways to subdivide $S$ into subsets that serve as the ramification locus of the connected components. Here, each $\chi_j$ appears in the binomial coefficient $k_j$ times.
  \item For components of genus $\geq 2$, we get a factor of $1/k_j!$ to account for overcounting.
  \item For components of genus $1$ we also get a factor of $1/k_j!$, since we either overcount (if some genus $1$ covers are non-isomorphic) or get extra automorphisms as permutations (if some genus $1$ covers are isomorphic).
  \item Putting this all together, we get that the weighted count of covers of type $\kappa$ is $a_\kappa$.
 \end{itemize}
\end{proof}